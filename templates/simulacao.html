<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o de Imposto | Mapeador e Simulador de Cr√©dito Tribut√°rio</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        {% include 'header.html' %}
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Steps Indicator -->
        {% set current_step = 4 %}
        {% include 'steps.html' %}

        <!-- Card -->
        <div class="card">
            <h1>C√°lculo de Imposto L√≠quido</h1>
            <p>Informe os valores obtidos na calculadora do governo para calcular o Imposto L√≠quido</p>

            <div class="info-box">
                <h3>F√≥rmula de C√°lculo:</h3>
                <p style="text-align: center; font-size: 18px; margin: 15px 0; color: #2787e9;">
                    <strong>Imposto L√≠quido = D√©bito Bruto - Cr√©dito Acumulado</strong>
                </p>
            </div>

            <form id="calculoForm" onsubmit="calcular(event)">
                <div class="calculation-grid">
                    <div class="form-group">
                        <label class="form-label" for="debitoBruto">D√©bito Bruto (R$) *</label>
                        <input
                            type="number"
                            id="debitoBruto"
                            name="debitoBruto"
                            class="form-input"
                            step="0.01"
                            min="0"
                            placeholder="0,00"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="creditoAcumulado">Cr√©dito Acumulado (R$) *</label>
                        <input
                            type="number"
                            id="creditoAcumulado"
                            name="creditoAcumulado"
                            class="form-input"
                            step="0.01"
                            min="0"
                            placeholder="0,00"
                            required
                        >
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    Calcular Imposto L√≠quido
                </button>
            </form>

            <div class="result-box" id="resultado" style="margin-top: 30px;">
                <h2 style="color: #2787e9; margin-bottom: 20px;">Resultado</h2>

                <div class="result-item">
                    <span class="result-label">D√©bito Bruto:</span>
                    <span class="result-value" id="resultDebitoBruto">R$ 0,00</span>
                </div>

                <div class="result-item">
                    <span class="result-label">Cr√©dito Acumulado:</span>
                    <span class="result-value" id="resultCreditoAcumulado">R$ 0,00</span>
                </div>

                <div class="result-highlight">
                    <div class="result-item">
                        <span class="result-label">Imposto L√≠quido:</span>
                        <span class="result-value" id="resultImpostoLiquido">R$ 0,00</span>
                    </div>
                </div>

                <div class="alert alert-info show" style="margin-top: 20px;">
                    <strong>üí° Interpreta√ß√£o:</strong>
                    <p style="margin-top: 10px; margin-bottom: 0;">
                        <span id="interpretacao"></span>
                    </p>
                </div>

                <div style="margin-top: 30px;">
                    <a href="/" class="btn btn-secondary btn-block">Nova Consulta</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const debitoBrutoInput = document.getElementById('debitoBruto');
        const creditoAcumuladoInput = document.getElementById('creditoAcumulado');
        const resultado = document.getElementById('resultado');

        // Formata√ß√£o de moeda
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function calcular(event) {
            event.preventDefault();

            const debitoBruto = parseFloat(debitoBrutoInput.value) || 0;
            const creditoAcumulado = parseFloat(creditoAcumuladoInput.value) || 0;
            const impostoLiquido = debitoBruto - creditoAcumulado;

            // Atualiza os valores no resultado
            document.getElementById('resultDebitoBruto').textContent = formatarMoeda(debitoBruto);
            document.getElementById('resultCreditoAcumulado').textContent = formatarMoeda(creditoAcumulado);
            document.getElementById('resultImpostoLiquido').textContent = formatarMoeda(impostoLiquido);

            // Interpreta√ß√£o do resultado
            let interpretacao = '';
            if (impostoLiquido > 0) {
                interpretacao = `Voc√™ ter√° um imposto l√≠quido de ${formatarMoeda(impostoLiquido)} a pagar. ` +
                                `Este √© o valor devido ap√≥s a dedu√ß√£o dos cr√©ditos acumulados.`;
            } else if (impostoLiquido < 0) {
                interpretacao = `Voc√™ possui um cr√©dito de ${formatarMoeda(Math.abs(impostoLiquido))} que pode ser ` +
                                `utilizado em opera√ß√µes futuras ou ressarcido conforme as regras da reforma tribut√°ria.`;
            } else {
                interpretacao = `Seu d√©bito bruto foi totalmente compensado pelos cr√©ditos acumulados. ` +
                                `N√£o h√° imposto l√≠quido a pagar nesta opera√ß√£o.`;
            }

            document.getElementById('interpretacao').textContent = interpretacao;

            // Mostra o resultado
            resultado.classList.add('show');

            // Scroll suave at√© o resultado
            resultado.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Formata√ß√£o dos inputs em tempo real
        [debitoBrutoInput, creditoAcumuladoInput].forEach(input => {
            input.addEventListener('blur', function(e) {
                if (e.target.value) {
                    const valor = parseFloat(e.target.value);
                    e.target.value = valor.toFixed(2);
                }
            });
        });
    </script>

    {% include 'footer.html' %}
</body>
</html>
